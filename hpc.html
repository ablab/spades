
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="rna.html">
      
      
        <link rel="next" href="binspreader.html">
      
      
      <link rel="icon" href="spades.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Running SPAdes across multiple nodes of a cluster - SPAdes Assembly Toolkit</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-spades-across-multiple-nodes-of-hpc-cluser" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="SPAdes Assembly Toolkit" class="md-header__button md-logo" aria-label="SPAdes Assembly Toolkit" data-md-component="logo">
      
  <img src="spades.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SPAdes Assembly Toolkit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Running SPAdes across multiple nodes of a cluster
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="SPAdes Assembly Toolkit" class="md-nav__button md-logo" aria-label="SPAdes Assembly Toolkit" data-md-component="logo">
      
  <img src="spades.png" alt="logo">

    </a>
    SPAdes Assembly Toolkit
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="getting-started.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick start
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    SPAdes input data
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            SPAdes input data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="input.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic input
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hybrid.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hybrid assembly
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="datatypes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tips on the parameters
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="running.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Command line options
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="output.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SPAdes output
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="hmm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HMM-guided mode
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="rna.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transcriptome assembly
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Running SPAdes across multiple nodes of a cluster
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="hpc.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Running SPAdes across multiple nodes of a cluster
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#compilation" class="md-nav__link">
    <span class="md-ellipsis">
      Compilation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-options" class="md-nav__link">
    <span class="md-ellipsis">
      Command line options
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="binspreader.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Binning refining
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="pathracer.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HMM mapping on assembly graph
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="spaligner.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sequence to graph alignment
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="standalone.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SPAdes tools
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="citation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Citation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="feedback.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feedback
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#compilation" class="md-nav__link">
    <span class="md-ellipsis">
      Compilation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-options" class="md-nav__link">
    <span class="md-ellipsis">
      Command line options
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="running-spades-across-multiple-nodes-of-hpc-cluser">Running SPAdes across multiple nodes of HPC cluser</h1>
<p>Running software on high-performance computational clusters usually involves
many options including, for example, the grid engine used, queue, resource allocation
among others. It is notoriously hard to support all these options in a
generic way. Essentially each cluster requires its unique configuration and
settings that cannot be predicted reasonably.</p>
<p>The grid mode of SPAdes handles all these details via a so-called 'Executor'. By
default, we provide executors for SLURM-based clusters (expecting a more or less
fresh SLURM and OpenMPI installation under the hood) and direct run over bare
<code>mpiexec</code>. While we have done our best to make them as generic as possible, there
still might be many unhandled corner cases unique to a particular computational
cluster. Users are encouraged to change the default implementation of executors
and/or write their own suitable for a particular cluster and job submission
system. Please contact us if some guidance is required.</p>
<p>There are a few important notes that should be taken into account here:</p>
<ul>
<li>Assembly with SPAdes involves the whole computational pipeline with different
  steps that need to be run in a particular order, as they use the results from
  the previous steps.</li>
<li>Not all steps of the SPAdes pipeline can be made parallel across multiple
  nodes of a cluster.</li>
<li>Even those that can be made parallel incur some non-negligible overhead
  required to communicate the inputs, synchronize the global state, and combine
  the results.</li>
<li>The mentioned overheads usually grow with the number of cluster nodes, so it
  might easily happen that running an assembly job across eight nodes would be
  slower than running across four nodes.</li>
<li>All the nodes periodically need to see the common state. As a result, the
  memory consumption of a single node could be comparable to running SPAdes
  alone on a single node. Essentially, while the total assembly time could be
  reduced by spreading the workload across multiple nodes, the memory
  consumption normally becomes the same.</li>
<li>The first node is the main one, combining all the data from worker
  nodes. Usually, it is the master node that consumes more memory, etc., and
  could benefit from, for example, <code>high-memory</code> nodes that are sometimes present
  on certain clusters. However, binding nodes in a non-uniform way across
  different available hardware resources usually requires some arcane settings
  for the job submission system, and this is fully left to the users.</li>
</ul>
<h2 id="compilation">Compilation</h2>
<p>To enable SPAdes HPC mode run</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>./spades_compile -SPADES_ENABLE_PROJECTS=hpcspades
</span></code></pre></div>
<p>As SPAdes HPC mode relies on MPI to split tasks across jobs sufficiently
sane MPI implementation is required. We only tested using OpenMPI. OpenMPI 3.x series
are known to contain important bugs resulting in deadlocks. OpenMPI 4.x and 
5.x worked fine in our tests.</p>
<p>After the compilation is complete, <code>spades-hpc</code> executable will be located in 
the <code>bin</code> folder.</p>
<p>It is recommended to always build hpcSPAdes using local MPI runtime, therefore
hpcSPAdes binaries are excluded from binary release snapshots.</p>
<h2 id="command-line-options">Command line options</h2>
<p>The options specific to SPAdes support for computational clusters are:</p>
<p><code>--grid-engine &lt;engine&gt;</code> The grid engine to use. <code>engine</code> might be one of:</p>
<ul>
<li><code>local</code>: run everything locally, no grid engine / job submission is involved</li>
<li><code>mpi</code>: same as <code>local</code>, but <code>mpiexec</code> is used to run the applications that
  support MPI</li>
<li><code>slurm</code>: job submission via SLURM</li>
<li><code>save_yaml</code>: dry run, save all the steps of SPAdes pipeline one after another into
  <code>run_spades.yaml</code> file.</li>
</ul>
<p>All executors also save <code>run_spades.sh</code> shell script. The execution of this
script is equal to running via <code>spades.py</code> (though some options are certainly
not supported here, like <code>--continue</code>). The shell script could be edited to tune
to a particular computational cluster and job submission system.</p>
<p><code>--grid-queue &lt;name&gt;</code> Name of queue to submit jobs to.</p>
<p><code>--grid-nnodes &lt;nodes&gt;</code> Number of nodes to use</p>
<p><code>--grid-wait</code> By default SPAdes submits all jobs and exits. This option would
make it wait for completion of the results</p>
<p>The following addtition options are specific to SLURM executor:</p>
<p><code>--grid-time &lt;value&gt;</code> Time limit for the job (corresponds to <code>--time</code> option of
<code>sbatch</code>)</p>
<p><code>--grid-extra &lt;options&gt;</code> Any extra options to pass to job submission system</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p><code>--only-generate-config</code> option might be useful to troubleshoot the job
submission and option. For SLURM executor it generates
<code>run_spades_on_cluster.sh</code> script with all <code>sbatch</code> / <code>srun</code> invocations used to
set up the execution of different steps of SPAdes pipeline via SLURM.</p>
<h2 id="references">References</h2>
<p>TBA</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["content.code.copy"], "search": "assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>